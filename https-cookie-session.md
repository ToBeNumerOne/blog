# 浅谈Https的安全
--------------
> 都说Https是安全的通信协议,那么Https安全在什么地方呢?它是如何做到安全的呢?

## 前言

前段时间,和同事在闲聊的过程中,突然间聊到了http与https的区别.同时同事也针对这些知识点,问了几个问题.事后感觉自己回答与讲解得不是很好,不由的深深鄙视了一下自己.最后自己上网查阅了一些资料,写下了这篇有关https科普的文章.知识点都不是新的,但是本文重在整理知识,侧重于梳理基础,方便对这些方面不太清楚的读者查阅.同时也方便笔者以后查阅.写的不当的地方,也恳请读者提出宝贵的修改意见.

## Https概念

[Https](https://en.wikipedia.org/wiki/HTTPS)也可以称作Http+TLS,或者Http+SSL,或者Http+Secure,是计算机网络中一种比较安全的通讯协议.Https可以理解成被Transport Layer Security(TLS)协议或者它的前辈Secure Sockets Layer(SSL)协议加密的Http协议.叙述概念有点绕口以及晦涩难懂,具体请往下看.

既然提到了Https,那么他和Http又有什么关系呢?为什么要使用他呢?首先需要明确说明的是Http协议是应用层的协议.在计算机网络的世界中,最重要也是最频繁就是数据的流动,数据的交互.Http协议只是规定数据如何封装,具体传送还是靠他的下一层协议TCP.TCP协议是传输层协议.使用Http协议,它向下传递给TCP的是明文数据,这无异于数据在裸奔.众所周知,数据在达到接受方之前,可能会经过许多的中间节点.使用明文传输,如果有恶意的中间节点存在,那么这些中间节点会获取到传输的数据,显然这是不安全的.面对这种情况,我们所想到的肯定是使用密文的方式传递,从而保证数据的安全性.但是使用密文传递就一定安全吗?如何确认发送与接收双方的身份的真实性?如何保证数据的完整性?这时候我们的猪脚Https就登场了.Https就是为了解决这3大问题而诞生的.我所理解的Https协议就是一种规范,一种安全的数据传输规范,不仅仅规定了如何加解密,同时为了涵盖安全,也规定了如何确认接受,发送双方身份的真实可靠以及确保所通信的数据完整,保密.较于Http,Https会想数据先下发到SSL/TLS层,他们讲数据进行加密,然后送到TCP进行传输.

## 数据的加密

说了半天Https会对数据进行加密,那么他是如何对数据加密的呢?在回答这个问题之前我们确认一下Https非常大概的流程,就是客户端与服务器之间建立Https连接,接下来进行消息的传递,采用对称加密发方法对数据进行加密与解密.之所以采用对称加密,因为对称加密效率高,速度快.何为对称加密,就是客户端和服务端使用同样的秘钥进行加解密.

使用对称加密,要求客户端和服务端公用一套秘钥,而这套秘钥是如何共享的呢?例如客户端使用秘钥加密数据发送给服务端,服务端又是如何获取到这个秘钥进行解密的呢?这时候就得说一下另一类加密算法,非对称加密算法.此类加密算法有很多种,常见的有RSA等算法.非对称加密算法有两个秘钥,一个公钥一个私钥.这俩秘钥的联系就是通过公钥加密的数据只有此私钥来能解开.通过此私钥加密的数据也只有此公钥才能解开.使用非对称加密算法,可以解决客户端和服务端之间如何使用同一套秘钥的问题.使用非对称加密的流程是服务端生成秘钥对,然后服务员将公钥发送给客户端,然后客户端使用公钥将数据加密送给服务端.接下来服务端使用私钥解密获取信息.

## 非对称加密就肯定安全吗?

如上,使用非对称加密,服务端在下发数据的时候,使用的是私钥加密.这就导致在服务端下发数据的时候,数据又是在裸奔.因为公钥是可以随意获取的,这就导致任何中间节点都可以使用公钥来解密数据.同时,公钥是如何下发给客户端的?如何保证客户端收到的公钥就一定是目标服务端下发的?

## 证书以及公钥证书

至于公钥是如何下发给客户端的,请容我慢慢道来.客户端在请求服务端的时候,服务端首先会下发一个证书.该证书是由一个非常权威的第三方机构颁发的.证书一般会包括服务端的姓名,组织等信息,还会包括服务端的公钥.这样解决了上述公钥下发的问题,但是上述的服务端下发的私钥加密数据问题如何解决呢?

其实采用非对称加密算法的Https的过程可以理解成以下步骤:

*	客户端访问服务端,服务端下发证书

*	客户端从证书中拿到公钥

*	客户端生成对称秘钥,使用获取到的公钥加密,从而传递给服务端

*	服务端通过私钥解密,获取对称秘钥 

*	客户端和服务端使用对称秘钥通信

从上述流程可以看到客户端在获取公钥之后,是通过对称秘钥的方式完成通信,所以也就不会存在服务端到客户端数据裸奔的情况. 

## 摘要以及数字签名

讲到这里,我觉得非常有必要说一下这几个概念.摘要就是哈希函数返回的一段固定长度的哈希值(说白了就是一个固定长度的串).




